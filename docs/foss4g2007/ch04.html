
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Routing PHP script with XML output &#8212; Open Source Routing Library</title>
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Workshop OpenLayers, pgRouting and OSM-data" href="../ol-workshop/index.html" />
    <link rel="prev" title="OpenLayers routing map" href="ch03.html" />
    

  </head><body>
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="../../index.html">pgRouting</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="../../index.html">Home</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../download.html">Download</a></li>
                <li><a href="../../support.html">Support</a></li>
                <li><a href="../../development.html">Development</a></li>
            </ul>

            <div id="searchbox">
                <form class="search" action="../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div>
        </div>
    </div>

    	
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Home</a> &#187;</li>
          <li><a href="../tutorials.html" >Workshops &amp; Tutorials</a> &#187;</li>
          <li><a href="index.html" accesskey="U">Web-based Routing: An Introduction to pgRouting with OpenLayers</a> &#187;</li>
        <li><a href="#">Routing PHP script with XML output</a></li>
      </ul>
    </div>
    

    	
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Routing PHP script with XML output</a><ul>
<li><a class="reference internal" href="#php-page-template-basics">PHP page template (basics)</a></li>
<li><a class="reference internal" href="#select-closest-edge">Select closest edge</a></li>
<li><a class="reference internal" href="#routing-query">Routing Query</a><ul>
<li><a class="reference internal" href="#for-shortest-path-dijkstra">For Shortest Path Dijkstra</a></li>
<li><a class="reference internal" href="#for-shortest-path-a-star">For Shortest Path A-Star</a></li>
<li><a class="reference internal" href="#for-shortest-path-shooting-star">For Shortest Path Shooting-Star</a></li>
<li><a class="reference internal" href="#query-database">Query database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#xml-output">XML output</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ch03.html"
                        title="previous chapter">OpenLayers routing map</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ol-workshop/index.html"
                        title="next chapter">Workshop OpenLayers, pgRouting and OSM-data</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="routing-php-script-with-xml-output">
<span id="foss4g2007-ch04"></span><h1>Routing PHP script with XML output<a class="headerlink" href="#routing-php-script-with-xml-output" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The content of this page is outdated and is for archiving purposes only.</p>
</div>
<div class="section" id="php-page-template-basics">
<h2>PHP page template (basics)<a class="headerlink" href="#php-page-template-basics" title="Permalink to this headline">¶</a></h2>
<p>We will use a PHP script to make the routing query and send the result back to the web client.</p>
<p>The following steps are necessary:</p>
<ul class="simple">
<li>Retrieve the start and end point coordinates.</li>
<li>Find the closest edge to start/end point.</li>
<li>Take either the start or end vertex of this edge (for Dijkstra/ A-Star) or the complete edge (Shooting-Star) as start of the route and end respectively.</li>
<li>Make the Shortest Path database query.</li>
<li>Transform the query result to XML and send it back to the web client.</li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

  <span class="c1">// Database connection settings</span>
  <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PG_DB&quot;</span>  <span class="p">,</span> <span class="s2">&quot;routing&quot;</span><span class="p">);</span>
  <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PG_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">);</span>
  <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PG_USER&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">);</span>
  <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PG_PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;5432&quot;</span><span class="p">);</span>
  <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;TABLE&quot;</span><span class="p">,</span>   <span class="s2">&quot;victoria&quot;</span><span class="p">);</span>

  <span class="nv">$counter</span> <span class="o">=</span> <span class="nv">$pathlength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Retrieve start point</span>
  <span class="nv">$start</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;startpoint&#39;</span><span class="p">]);</span>
  <span class="nv">$startPoint</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$start</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

  <span class="c1">// Retrieve end point</span>
  <span class="nv">$end</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;finalpoint&#39;</span><span class="p">]);</span>
  <span class="nv">$endPoint</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$end</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

  <span class="cm">/* ... */</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="select-closest-edge">
<h2>Select closest edge<a class="headerlink" href="#select-closest-edge" title="Permalink to this headline">¶</a></h2>
<p>Usually the start and end point, which we retrieved from the client, is not the
start or end vertex of an edge. It is more convenient to look for the closest
edge than for the closest vertex, because Shooting Star algorithm is “edge-based”.
For “vertex-based” algorithms (Dijkstra, A-Star) we can choose arbitrary start
or end of the selected edge.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="c1">// Find the nearest edge</span>
  <span class="nv">$startEdge</span> <span class="o">=</span> <span class="nx">findNearestEdge</span><span class="p">(</span><span class="nv">$startPoint</span><span class="p">);</span>
  <span class="nv">$endEdge</span>   <span class="o">=</span> <span class="nx">findNearestEdge</span><span class="p">(</span><span class="nv">$endPoint</span><span class="p">);</span>

  <span class="c1">// FUNCTION findNearestEdge</span>
  <span class="k">function</span> <span class="nf">findNearestEdge</span><span class="p">(</span><span class="nv">$lonlat</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Connect to database</span>
        <span class="nv">$con</span> <span class="o">=</span> <span class="nb">pg_connect</span><span class="p">(</span><span class="s2">&quot;dbname=&quot;</span><span class="o">.</span><span class="nx">PG_DB</span><span class="o">.</span><span class="s2">&quot; host=&quot;</span><span class="o">.</span><span class="nx">PG_HOST</span><span class="o">.</span><span class="s2">&quot; user=&quot;</span><span class="o">.</span><span class="nx">PG_USER</span><span class="p">);</span>

        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT gid, source, target, the_geom,</span>
<span class="s2">                         distance(the_geom, GeometryFromText(</span>
<span class="s2">                      &#39;POINT(&quot;</span><span class="o">.</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;)&#39;, 54004)) AS dist</span>
<span class="s2">                FROM &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;</span>
<span class="s2">                WHERE the_geom &amp;&amp; setsrid(</span>
<span class="s2">                      &#39;BOX3D(&quot;</span><span class="o">.</span><span class="p">(</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span>
<span class="s2">                             &quot;</span><span class="o">.</span><span class="p">(</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                             &quot;</span><span class="o">.</span><span class="p">(</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span>
<span class="s2">                             &quot;</span><span class="o">.</span><span class="p">(</span><span class="nv">$lonlat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;)&#39;::box3d, 54004)</span>
<span class="s2">                ORDER BY dist LIMIT 1&quot;</span><span class="p">;</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="nb">pg_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span><span class="nv">$sql</span><span class="p">);</span>

        <span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="nb">pg_fetch_result</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">pg_fetch_result</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">pg_fetch_result</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;the_geom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pg_fetch_result</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

        <span class="c1">// Close database connection</span>
        <span class="nb">pg_close</span><span class="p">(</span><span class="nv">$con</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$edge</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="routing-query">
<h2>Routing Query<a class="headerlink" href="#routing-query" title="Permalink to this headline">¶</a></h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="c1">// Select the routing algorithm</span>
  <span class="k">switch</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span> <span class="p">{</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="for-shortest-path-dijkstra">
<h3>For Shortest Path Dijkstra<a class="headerlink" href="#for-shortest-path-dijkstra" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
        <span class="k">case</span> <span class="s1">&#39;SPD&#39;</span> <span class="o">:</span> <span class="c1">// Shortest Path Dijkstra</span>

          <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT rt.gid, AsText(rt.the_geom) AS wkt,</span>
<span class="s2">                       length(rt.the_geom) AS length, &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.id</span>
<span class="s2">                    FROM &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                        (SELECT gid, the_geom</span>
<span class="s2">                            FROM dijkstra_sp_delta(</span>
<span class="s2">                                &#39;&quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;&#39;,</span>
<span class="s2">                                &quot;</span><span class="o">.</span><span class="nv">$startEdge</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                &quot;</span><span class="o">.</span><span class="nv">$endEdge</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                3000)</span>
<span class="s2">                         ) as rt</span>
<span class="s2">                    WHERE &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.gid=rt.gid;&quot;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="for-shortest-path-a-star">
<h3>For Shortest Path A-Star<a class="headerlink" href="#for-shortest-path-a-star" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
        <span class="k">case</span> <span class="s1">&#39;SPA&#39;</span> <span class="o">:</span> <span class="c1">// Shortest Path A*</span>

          <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT rt.gid, AsText(rt.the_geom) AS wkt,</span>
<span class="s2">                         length(rt.the_geom) AS length, &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.id</span>
<span class="s2">                      FROM &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                          (SELECT gid, the_geom</span>
<span class="s2">                              FROM astar_sp_delta(</span>
<span class="s2">                                  &#39;&quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;&#39;,</span>
<span class="s2">                                  &quot;</span><span class="o">.</span><span class="nv">$startEdge</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                  &quot;</span><span class="o">.</span><span class="nv">$endEdge</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                  3000)</span>
<span class="s2">                           ) as rt</span>
<span class="s2">                      WHERE &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.gid=rt.gid;&quot;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="for-shortest-path-shooting-star">
<h3>For Shortest Path Shooting-Star<a class="headerlink" href="#for-shortest-path-shooting-star" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
        <span class="k">case</span> <span class="s1">&#39;SPS&#39;</span> <span class="o">:</span> <span class="c1">// Shortest Path Shooting*</span>

          <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT rt.gid, AsText(rt.the_geom) AS wkt,</span>
<span class="s2">                         length(rt.the_geom) AS length, &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.id</span>
<span class="s2">                      FROM &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                          (SELECT gid, the_geom</span>
<span class="s2">                              FROM shootingstar_sp(</span>
<span class="s2">                                  &#39;&quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;&#39;,</span>
<span class="s2">                                  &quot;</span><span class="o">.</span><span class="nv">$startEdge</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                  &quot;</span><span class="o">.</span><span class="nv">$endEdge</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;,</span>
<span class="s2">                                  5000, &#39;length&#39;, true, true)</span>
<span class="s2">                           ) as rt</span>
<span class="s2">                      WHERE &quot;</span><span class="o">.</span><span class="nx">TABLE</span><span class="o">.</span><span class="s2">&quot;.gid=rt.gid;&quot;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="query-database">
<h3>Query database<a class="headerlink" href="#query-database" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="p">}</span> <span class="c1">// close switch</span>

  <span class="c1">// Connect to database</span>
  <span class="nv">$dbcon</span> <span class="o">=</span> <span class="nb">pg_connect</span><span class="p">(</span><span class="s2">&quot;dbname=&quot;</span><span class="o">.</span><span class="nx">PG_DB</span><span class="o">.</span><span class="s2">&quot; host=&quot;</span><span class="o">.</span><span class="nx">PG_HOST</span><span class="o">.</span><span class="s2">&quot; user=&quot;</span><span class="o">.</span><span class="nx">PG_USER</span><span class="p">);</span>

  <span class="c1">// Perform database query</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="nb">pg_query</span><span class="p">(</span><span class="nv">$dbcon</span><span class="p">,</span><span class="nv">$sql</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="xml-output">
<h2>XML output<a class="headerlink" href="#xml-output" title="Permalink to this headline">¶</a></h2>
<p>OpenLayers allows to draw lines directly using WKT (Well-Known Text) format.
This makes the XML output short and simple:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="c1">// Return route as XML</span>
  <span class="nv">$xml</span>  <span class="o">=</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;&#39;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;&lt;route&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="c1">// Add edges to XML file</span>
  <span class="k">while</span><span class="p">(</span><span class="nv">$edge</span><span class="o">=</span><span class="nb">pg_fetch_assoc</span><span class="p">(</span><span class="nv">$query</span><span class="p">))</span> <span class="p">{</span>

        <span class="nv">$pathlength</span> <span class="o">+=</span> <span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">];</span>

        <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&lt;edge id=&#39;&quot;</span><span class="o">.++</span><span class="nv">$counter</span><span class="o">.</span><span class="s2">&quot;&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&lt;id&gt;&quot;</span><span class="o">.</span><span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;/id&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&lt;wkt&gt;&quot;</span><span class="o">.</span><span class="nv">$edge</span><span class="p">[</span><span class="s1">&#39;wkt&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;/wkt&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&lt;length&gt;&quot;</span><span class="o">.</span><span class="nb">round</span><span class="p">((</span><span class="nv">$pathlength</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&lt;/length&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&lt;/edge&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$xml</span> <span class="o">.=</span> <span class="s2">&quot;&lt;/route&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="c1">// Close database connection</span>
  <span class="nb">pg_close</span><span class="p">(</span><span class="nv">$dbcon</span><span class="p">);</span>

  <span class="c1">// Return routing result</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-type: text/xml&#39;</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
  <span class="k">echo</span> <span class="nv">$xml</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="../ol-workshop/index.html" title="Workshop OpenLayers, pgRouting and OSM-data"
                 accesskey="N">next</a></li>
            <li class="right" >
              <a href="ch03.html" title="OpenLayers routing map"
                 accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Home</a> &#187;</li>
          <li><a href="../tutorials.html" >Workshops &amp; Tutorials</a> &#187;</li>
          <li><a href="index.html" >Web-based Routing: An Introduction to pgRouting with OpenLayers</a> &#187;</li>
        <li><a href="#">Routing PHP script with XML output</a></li>
      </ul>
    </div>

	<div class="footer">
      	&copy; Copyright, pgRouting Community<br/>
      	pgRouting website is hosted on <a href="https://github.com/pgRouting/website">Github</a> |
      	<script type="text/javascript">
      		document.write('<a href="mailto:' + new Array("project","pgrouting.org").join("@") + '">Contact administrators</a>');
      	</script>
    </div>


  </body>
</html>