
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Diagnostic Tools &#8212; Open Source Routing Library</title>
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to show the route with Mapserver" href="mapserver.html" />
    <link rel="prev" title="Converting OSM-Files into PostgreSQL-Scripts" href="convert_osm.html" />
    

  </head><body>
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="../../index.html">pgRouting</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="../../index.html">Home</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../download.html">Download</a></li>
                <li><a href="../../support.html">Support</a></li>
                <li><a href="../../development.html">Development</a></li>
            </ul>

            <div id="searchbox">
                <form class="search" action="../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div>
        </div>
    </div>

    	
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Home</a> &#187;</li>
          <li><a href="../../documentation.html" >Documentation</a> &#187;</li>
          <li><a href="../howto.html" accesskey="U">pgRouting Howto’s</a> &#187;</li>
        <li><a href="#">Diagnostic Tools</a></li>
      </ul>
    </div>
    

    	
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Diagnostic Tools</a><ul>
<li><a class="reference internal" href="#view-just-the-streets-in-the-routing-database">1. View just the streets in the routing database</a></li>
<li><a class="reference internal" href="#view-intersections-and-detect-deadends">2. View intersections and detect deadends</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="convert_osm.html"
                        title="previous chapter">Converting OSM-Files into PostgreSQL-Scripts</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mapserver.html"
                        title="next chapter">How to show the route with Mapserver</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="diagnostic-tools">
<span id="diagnostics"></span><h1>Diagnostic Tools<a class="headerlink" href="#diagnostic-tools" title="Permalink to this headline">¶</a></h1>
<p>pgRouting is a large black box to most users. When things are working nobody has
a problem, but when it is not working as expected what do you do? One of the
most common problems is issues with the routing data. I built the following
tools that aew easy to implement and use and can reveal a lot about your data.
I assume that you are working with OpenLayers as you map viewer and we will
build two visualization tools.</p>
<ol class="arabic simple">
<li>View just the streets in the routing database</li>
<li>View intersections and detect deadends</li>
</ol>
<p>You can see these tools in action at <a class="reference external" href="http://imaptools.com/leaddog/routing/dd.html">http://imaptools.com/leaddog/routing/dd.html</a>
Zoom into a city, open the layerswitcher and select “Just the Streets” and “Dead Ends”.</p>
<div class="section" id="view-just-the-streets-in-the-routing-database">
<h2>1. View just the streets in the routing database<a class="headerlink" href="#view-just-the-streets-in-the-routing-database" title="Permalink to this headline">¶</a></h2>
<p>Create a mapfile that displays the street segments from the routing
database and add this as an optional base layer. You might want to add
color oneway streets a different color, but in general keep the display
simple and probably single pixel lines. You might label the segments
with their UID so you can go back to the database and query them in detail.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>LAYER
        NAME <span class="s2">&quot;Streets&quot;</span>
        STATUS DEFAULT
        TYPE LINE
        CONNECTIONTYPE postgis
        CONNECTION <span class="s2">&quot;user=postgres dbname=routing host=centos port=5432&quot;</span>
        DATA <span class="s2">&quot;the_geom from (select gid, the_geom from st) as foo</span>
<span class="s2">                  using SRID=4326 using unique gid&quot;</span>
        LABELITEM <span class="s2">&quot;gid&quot;</span>
        MAXLABELSCALEDENOM <span class="m">25000</span>
        CLASS
          STYLE
                COLOR <span class="m">87</span> <span class="m">87</span> <span class="m">87</span>
                WIDTH <span class="m">1</span>
          END
          LABEL
                FONT <span class="s2">&quot;arial&quot;</span>
                TYPE TRUETYPE
                ANGLE AUTO
                SIZE <span class="m">7</span>
                COLOR <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>
          END
        END
        END

        symbol
        name <span class="s2">&quot;one_way_from&quot;</span>
        <span class="nb">type</span> truetype
        font arial-bold
        character <span class="s2">&quot;&gt;&quot;</span>
        gap -40
        end

        symbol
        name <span class="s2">&quot;one_way_to&quot;</span>
        <span class="nb">type</span> truetype
        font arial-bold
        character <span class="s2">&quot;&lt;&quot;</span>
        gap -40
        end


        LAYER
        NAME <span class="s2">&quot;One_Way_Arrows&quot;</span>
        STATUS DEFAULT
        TYPE LINE
        MAXSCALEDENOM <span class="m">25000</span>
        CONNECTIONTYPE postgis
        CONNECTION <span class="s2">&quot;user=postgres dbname=routing host=centos port=5432&quot;</span>
        DATA <span class="s2">&quot;the_geom from (select gid, one_way, the_geom from st</span>
<span class="s2">                  where one_way is not null and length(one_way)&gt;0) as foo</span>
<span class="s2">                  using SRID=4326 using unique gid&quot;</span>
        CLASSITEM <span class="s1">&#39;one_way&#39;</span>
        CLASS
          NAME <span class="s1">&#39;From&#39;</span>
          EXPRESSION <span class="s2">&quot;FT&quot;</span>
          STYLE
                SYMBOL <span class="s2">&quot;one_way_from&quot;</span>
                COLOR <span class="m">80</span> <span class="m">80</span> <span class="m">80</span>
                SIZE <span class="m">8</span>
          END
        END
        CLASS
          NAME <span class="s1">&#39;To&#39;</span>
          EXPRESSION <span class="s2">&quot;TF&quot;</span>
          STYLE
                SYMBOL <span class="s2">&quot;one_way_to&quot;</span>
                COLOR <span class="m">80</span> <span class="m">80</span> <span class="m">80</span>
                SIZE <span class="m">8</span>
          END
        END
END
</pre></div>
</div>
</div>
<div class="section" id="view-intersections-and-detect-deadends">
<h2>2. View intersections and detect deadends<a class="headerlink" href="#view-intersections-and-detect-deadends" title="Permalink to this headline">¶</a></h2>
<p>Add a column cnt integer to the vertices_tmp table and update it with the count
of segments that reference that node. Maybe something like this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">alter</span> <span class="k">table</span> <span class="n">vertices_tmp</span> <span class="k">add</span> <span class="k">column</span> <span class="n">cnt</span> <span class="nb">integer</span><span class="p">;</span>
<span class="k">update</span> <span class="n">vertices_tmp</span> <span class="k">set</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">update</span> <span class="n">vertices_tmp</span> <span class="k">set</span> <span class="n">cnt</span><span class="o">=</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span> <span class="k">where</span> <span class="n">streets</span><span class="p">.</span><span class="k">source</span><span class="o">=</span><span class="n">id</span><span class="p">;</span>
<span class="k">update</span> <span class="n">vertices_tmp</span> <span class="k">set</span> <span class="n">cnt</span><span class="o">=</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span> <span class="k">where</span> <span class="n">streets</span><span class="p">.</span><span class="n">target</span><span class="o">=</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<p>Now create a mapfile layer for points and display the vertices_tmp</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>LAYER
   NAME <span class="s2">&quot;deadends&quot;</span>
   TYPE POINT
   CONNECTIONTYPE <span class="s2">&quot;postgis&quot;</span>
   CONNECTION ...
   DATA ...
   CLASSEXPRESSION <span class="s2">&quot;cnt&quot;</span>
   CLASS
         EXPRESSION <span class="s2">&quot;cnt=1&quot;</span>
         STYLE
           SYMBOL <span class="s2">&quot;circle&quot;</span>
           SIZE <span class="m">5</span>
           COLOR <span class="m">255</span> <span class="m">0</span> <span class="m">0</span>
         END
   END
   CLASS
         EXPRESSION <span class="s2">&quot;cnt&gt;2&quot;</span>
         STYLE
           SYMBOL <span class="s2">&quot;circle&quot;</span>
           SIZE <span class="m">3</span>
           COLOR <span class="m">0</span> <span class="m">255</span> <span class="m">0</span>
         END
   END
END
</pre></div>
</div>
<p>This will display red dots at dead ends and green dots as good connections be
segments. If you have a lot of red dots between segments that should be joined,
you probably need to rebuild your vertices_tmp table with a larger tolerance.</p>
<p>It is very hard to debug a large black box like a router without having some
tools that can give you some better insight as to what is going on.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="mapserver.html" title="How to show the route with Mapserver"
                 accesskey="N">next</a></li>
            <li class="right" >
              <a href="convert_osm.html" title="Converting OSM-Files into PostgreSQL-Scripts"
                 accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Home</a> &#187;</li>
          <li><a href="../../documentation.html" >Documentation</a> &#187;</li>
          <li><a href="../howto.html" >pgRouting Howto’s</a> &#187;</li>
        <li><a href="#">Diagnostic Tools</a></li>
      </ul>
    </div>

	<div class="footer">
      	&copy; Copyright, pgRouting Community<br/>
      	pgRouting website is hosted on <a href="https://github.com/pgRouting/website">Github</a> |
      	<script type="text/javascript">
      		document.write('<a href="mailto:' + new Array("project","pgrouting.org").join("@") + '">Contact administrators</a>');
      	</script>
    </div>

	<!-- Piwik -->
	<script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.georepublic.net/" : "http://stats.georepublic.net/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script type="text/javascript">
	try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 3);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
	} catch( err ) {}
	</script><noscript><p><img src="http://stats.georepublic.net/piwik.php?idsite=3" style="border:0" alt="" /></p></noscript>
	<!-- End Piwik Tag -->

  </body>
</html>