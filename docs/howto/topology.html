<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating Data for Routing Applications &mdash; Open Source Routing Library</title>
    
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Open Source Routing Library" href="../../index.html" />
    <link rel="up" title="pgRouting Howto’s" href="../howto.html" />
    <link rel="next" title="Network data validation" href="validation.html" />
    <link rel="prev" title="Collection of useful SQL commands" href="sql.html" />
    

  </head>
  <body role="document">
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="../../index.html">pgRouting</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="../../index.html">Home</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../download.html">Download</a></li>
                <li><a href="../../support.html">Support</a></li>
                <li><a href="../../development.html">Development</a></li>
            </ul>

            <div id="searchbox">
                <form class="search" action="../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div>
        </div>
    </div>

    	
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Home</a> &raquo;</li>
          <li><a href="../../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="../howto.html" accesskey="U">pgRouting Howto&#8217;s</a> &raquo;</li>
        <li><a href="#">Creating Data for Routing Applications</a></li>
      </ul>
    </div>
    

    	
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating Data for Routing Applications</a><ul>
<li><a class="reference internal" href="#graphs-directed-undirected-reverse-costs">Graphs, Directed, unDirected, Reverse Costs</a></li>
<li><a class="reference internal" href="#pgrouting">pgRouting</a></li>
<li><a class="reference internal" href="#postgis">PostGIS</a></li>
<li><a class="reference internal" href="#arcinfo">ArcInfo</a></li>
<li><a class="reference internal" href="#grass">GRASS</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sql.html"
                        title="previous chapter">Collection of useful SQL commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="validation.html"
                        title="next chapter">Network data validation</a></p>
    
    <h2>Make a Donation</h2>
    <p>
		<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" name="hosted_button_id" value="K6GT9CC2ZPTDG">
			<input type="hidden" name="business" value="donate@pgrouting.org">
			<input type="hidden" name="notify_url" value="http://www.pgrouting.org">
			<input type="hidden" name="item_name" value="Donation for pgRouting Project">
			<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" style="border:none;">
			<select name="currency_code" class="paypal_currency">
				<option value="EUR" title="€" selected="">EUR</option>
				<option value="AUD" title="$">AUD</option>
				<option value="GBP" title="£">GBP</option>
				<option value="JPY" title="¥">JPY</option>
				<option value="CAD" title="$">CAD</option>
				<option value="CHF" title="">CHF</option>
				<option value="USD" title="$">USD</option>
			</select>
			<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
			<br/>Support pgRouting with some donation! <a href="../../donate.html">Read more</a> about how your donation will help the project.
		</form>				
    </p>
    <h2>Links</h2>
    <ul style="list-style: square; margin-left: 20px;">
        <li><a href="http://workshop.pgrouting.org/">pgRouting Workshop</a></li>
    	<li><a href="http://www.postgresql.org/">PostgreSQL</a></li>
    	<li><a href="http://www.postgis.net/">PostGIS</a></li>
    </ul>
    
    <!-- Callout -->
    <div class="callout-sidebar">
        <a href="http://2016.foss4g.org">
        <img src="../../_static/img/foss4g_2016.png" 
            alt="FOSS4G 2016, Bonn" title="FOSS4G 2016, Bonn" style="width:210px;"/>
        </a>
        
        <!--a href="http://europe.foss4g.org">
        <img src="../../_static/img/foss4ge_2015.png" 
            alt="FOSS4G Europe 2015, Como" title="FOSS4G Europe 2015, Como" style="height:130px;"/>
        </a-->
        
        <!--a href="http://www.fossgis.de/konferenz/2015/">
        <img src="../../_static/img/fossgis_2015.png" 
            alt="FOSSGIS 2015, Münster" title="FOSSGIS 2015, Münster" style="height:130px;"/>
        </a-->
        
        <!--a href="http://wiki.osgeo.org/wiki/Google_Summer_of_Code_2015">
        <img src="../../_static/img/gsoc_2015.jpg" 
            alt="Google Summer of Code 2015" title="Google Summer of Code 2015" style="height:130px;"/>
        </a-->
        
        <a href="http://www.osgeo.org">
        <img src="../../_static/img/OSGeo_logo.png" 
        	alt="OSGeo Foundation" title="OSGeo Foundation" style="width:210px;"/>
        </a>
    </div>

        </div>
      </div>
    


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-data-for-routing-applications">
<span id="topology"></span><h1>Creating Data for Routing Applications<a class="headerlink" href="#creating-data-for-routing-applications" title="Permalink to this headline">¶</a></h1>
<p>Routing Engines always require the source and target nodes for every line in
order to create a search for the shortest path. Creating this data on line
networks involves creating a topology on that network.</p>
<div class="section" id="graphs-directed-undirected-reverse-costs">
<h2>Graphs, Directed, unDirected, Reverse Costs<a class="headerlink" href="#graphs-directed-undirected-reverse-costs" title="Permalink to this headline">¶</a></h2>
<p>The follow will hopefully explain a little bit about graphs and and how to use
the directed and reverse cost arguments in the pgRouting function calls. If you
use assign_vertex_id() to build your graph, it builds an undirected graph. Now
you might have some oneway streets and you can create a reverse_cost column and
start by populating it with the cost column values. Now you can treat you graph
as a directed graph using the forward cost and reverse_cost for the cost to
traverse an edge from A-B or B-A respectively. Since these values are all the
same it is not very interesting, but if you have oneway streets you can now edit
the cost or the reverse_cost values so that the wrong way has a very high cost.
Many of the pgRouting function have boolean arguments &#8216;&#8217;&#8216;directed&#8217;&#8216;&#8217; and
&#8216;&#8217;&#8216;has_reverse_cost&#8217;&#8216;&#8217;. If you set &#8216;&#8217;&#8216;has_reverse_cost=true&#8217;&#8216;&#8217;, you should also
set &#8216;&#8217;&#8216;directed=true&#8217;&#8216;&#8217; or it will ignore your reverse costs.</p>
</div>
<div class="section" id="pgrouting">
<h2>pgRouting<a class="headerlink" href="#pgrouting" title="Permalink to this headline">¶</a></h2>
<p>pgRouting gives the ability to create the source-target (start-end nodes)
information within PostgreSQL using assign_vertex_id():</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">assign_vertex_id</span><span class="p">(</span><span class="k">table_name</span><span class="p">,</span> <span class="n">snapping_range</span><span class="p">,</span> <span class="n">geometry_column_name</span><span class="p">,</span> <span class="n">edge_id_column_name</span><span class="p">);</span>
</pre></div>
</div>
<p>where table_name is the name of the edges table, nodes within snapping_range
(value is in your current projection units) will be snapped, geometry_column_name
is the name of the geometry column (usually &#8216;the_geom&#8217;), edge_id_column_name is
the name of the edge id column (usually gid).</p>
<p>This function requires &#8216;source&#8217; and &#8216;target&#8217; integer fields.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ways</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">source</span> <span class="nb">integer</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ways</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">target</span> <span class="nb">integer</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">assign_vertex_id</span><span class="p">(</span><span class="s1">&#39;ways&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">00001</span><span class="p">,</span> <span class="s1">&#39;the_geom&#39;</span><span class="p">,</span> <span class="s1">&#39;gid&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>There is other software, that can be used to create a topology:</p>
</div>
<div class="section" id="postgis">
<h2>PostGIS<a class="headerlink" href="#postgis" title="Permalink to this headline">¶</a></h2>
<p>As of this writing, the latest <a class="reference external" href="http://www.postgis.net">PostGIS</a> 1.1.2, has
started adding a topology functionality. But it is still in a very alpha stage
and there are very little documentation yet on how to create the topology. This
page will be updated once the topology functionality becomes stable enough to use.</p>
</div>
<div class="section" id="arcinfo">
<h2>ArcInfo<a class="headerlink" href="#arcinfo" title="Permalink to this headline">¶</a></h2>
<p>For those with an !ArcInfo license, creating a topology is done by just issuing
the BUILD command:</p>
<div class="highlight-bash"><div class="highlight"><pre>build line <span class="o">{</span>Coverage Name<span class="o">}</span>
</pre></div>
</div>
<p>and then exporting the coverage to a shape file, which can then be imported into
PostGIS. The BUILD command will build fnode, tnode, length columns which can
be renamed in PostgreSQL into source and target, and the length can be set as
the intial cost.</p>
</div>
<div class="section" id="grass">
<h2>GRASS<a class="headerlink" href="#grass" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://grass.itc.it">GRASS</a> can be used also to create a topology, but
extracting the topology information and bringing it into PostgreSQL is not as
simple as that of !ArcInfo&#8217;s since the topolgy information is not included into
with the data set when it is exported to a shape file.</p>
<p>The topolgy creation command &#8220;v.build&#8221; has a dump option though that will output
the information into the stream which in turn can be piped into to a file.
For example:</p>
<div class="highlight-bash"><div class="highlight"><pre>v.build <span class="nv">map</span><span class="o">=</span>dourol <span class="nv">option</span><span class="o">=</span>build,dump &gt; dourokukan.txt
</pre></div>
</div>
<p>The output will be like this;</p>
<div class="highlight-bash"><div class="highlight"><pre>---------- TOPOLOGY DUMP ----------
N,S,E,W,T,B: 35.897887, 24.281578, 153.985841, 138.943042, 0.000000, 0.000000
Nodes <span class="o">(</span><span class="m">148304</span> nodes, alive + dead <span class="o">)</span>:
<span class="nv">node</span> <span class="o">=</span> 1, <span class="nv">n_lines</span> <span class="o">=</span> 3, <span class="nv">xy</span> <span class="o">=</span> 139.756532, 35.67451
<span class="nv">line</span> <span class="o">=</span> 1, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">angle</span> <span class="o">=</span> -2.265356
<span class="nv">line</span> <span class="o">=</span> -20, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">angle</span> <span class="o">=</span> -0.055499
<span class="nv">line</span> <span class="o">=</span> 8, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">angle</span> <span class="o">=</span> 1.281166
<span class="nv">node</span> <span class="o">=</span> 2, <span class="nv">n_lines</span> <span class="o">=</span> 3, <span class="nv">xy</span> <span class="o">=</span> 139.756261, 35.674216
<span class="nv">line</span> <span class="o">=</span> -9, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">angle</span> <span class="o">=</span> -2.827622
<span class="nv">line</span> <span class="o">=</span> 2, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">angle</span> <span class="o">=</span> -1.878154
...
...
...
Lines <span class="o">(</span><span class="m">220672</span> lines, alive + dead <span class="o">)</span>:
<span class="nv">line</span> <span class="o">=</span> 1, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">offset</span> <span class="o">=</span> <span class="m">14</span> <span class="nv">n1</span> <span class="o">=</span> 1, <span class="nv">n2</span> <span class="o">=</span> 2, left/area <span class="o">=</span> 0, <span class="nv">right</span> <span class="o">=</span> 0
N,S,E,W,T,B: 35.674510, 35.674216, 139.756532, 139.756261, 0.000000, 0.000000
<span class="nv">line</span> <span class="o">=</span> 2, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">offset</span> <span class="o">=</span> <span class="m">79</span> <span class="nv">n1</span> <span class="o">=</span> 2, <span class="nv">n2</span> <span class="o">=</span> 3, left/area <span class="o">=</span> 0, <span class="nv">right</span> <span class="o">=</span> 0
N,S,E,W,T,B: 35.674216, 35.672010, 139.756261, 139.755285, 0.000000, 0.000000
<span class="nv">line</span> <span class="o">=</span> 3, <span class="nb">type</span> <span class="o">=</span> 2, <span class="nv">offset</span> <span class="o">=</span> <span class="m">160</span> <span class="nv">n1</span> <span class="o">=</span> 3, <span class="nv">n2</span> <span class="o">=</span> 4, left/area <span class="o">=</span> 0, <span class="nv">right</span> <span class="o">=</span> 0
N,S,E,W,T,B: 35.672010, 35.671649, 139.755285, 139.755014, 0.000000, 0.000000
</pre></div>
</div>
<p>A perl program like <a class="reference download internal" href="../../_downloads/table_topo.pl" download=""><code class="xref download docutils literal"><span class="pre">table_topo.pl</span></code></a>
can be used to convert GRASS output into SQL files that will create node and
line tables containing the topological information. These tables can then be
linked into the PostGIS network table to create the source-target node
information.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="validation.html" title="Network data validation"
                 accesskey="N">next</a></li>
            <li class="right" >
              <a href="sql.html" title="Collection of useful SQL commands"
                 accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Home</a> &raquo;</li>
          <li><a href="../../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="../howto.html" >pgRouting Howto&#8217;s</a> &raquo;</li>
        <li><a href="#">Creating Data for Routing Applications</a></li>
      </ul>
    </div>

	<div class="footer">
      	&copy; Copyright, pgRouting Community<br/>
      	pgRouting website is hosted on <a href="https://github.com/pgRouting/website">Github</a> |       	
      	<script type="text/javascript"> 
      		document.write('<a href="mailto:' + new Array("project","pgrouting.org").join("@") + '">Contact administrators</a>'); 
      	</script>
    </div>
    
	<!-- Piwik -->
	<script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.georepublic.net/" : "http://stats.georepublic.net/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script type="text/javascript">
	try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 3);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
	} catch( err ) {}
	</script><noscript><p><img src="http://stats.georepublic.net/piwik.php?idsite=3" style="border:0" alt="" /></p></noscript>
	<!-- End Piwik Tag -->

  </body>
</html>