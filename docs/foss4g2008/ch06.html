
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Load your network data and create a network topology &#8212; Open Source Routing Library</title>
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    

  </head><body>
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="../../index.html">pgRouting</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="../../index.html">Home</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../download.html">Download</a></li>
                <li><a href="../../support.html">Support</a></li>
                <li><a href="../../development.html">Development</a></li>
            </ul>

            <div id="searchbox">
                <form class="search" action="../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div>
        </div>
    </div>

    	
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Home</a> &#187;</li>
        <li><a href="#">Load your network data and create a network topology</a></li>
      </ul>
    </div>
    

    	
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Load your network data and create a network topology</a><ul>
<li><a class="reference internal" href="#load-the-network-data">Load the network data</a></li>
<li><a class="reference internal" href="#create-network-topology">Create network topology</a></li>
<li><a class="reference internal" href="#add-indices">Add indices</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="load-your-network-data-and-create-a-network-topology">
<span id="foss4g2008-ch06"></span><h1>Load your network data and create a network topology<a class="headerlink" href="#load-your-network-data-and-create-a-network-topology" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The content of this page is outdated and is for archiving purposes only.</p>
</div>
<p>Some network data already comes with a network topology that can be used with
pgRouting immediately. But usually the data is in a different format than we
need for pgRouting. Often network data is stored in the Shape file format (.shp)
and we can use PostGIS’ shape2postgresql converter to import the data into the
database. OpenStreetMap stores its data as XML and it has its own importing
tools for PostgreSQL database.</p>
<p>Later we will use the osm2pgrouting converter. But it does much more than the
basic steps for simple routing, so we will start this workshop with the minimum
required attributes.</p>
<div class="section" id="load-the-network-data">
<h2>Load the network data<a class="headerlink" href="#load-the-network-data" title="Permalink to this headline">¶</a></h2>
<p>After creating the workshop database and adding the PostGIS and pgRouting
functions to this database (see previous chapter), we load the sample data to
our database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>psql -U postgres routing
<span class="se">\i</span> /home/foss4g/ways_without_topology.sql
</pre></div>
</div>
<p>Note: The SQL dump file was made from a database which already had PostGIS
functions loaded, so it will report errors during import that these functions
already exist. You can ignore these errors.</p>
<p>Let’s see witch tables have been created:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>\d

                  List of relations
 Schema |       Name       | Type  |  Owner
--------+------------------+-------+----------
 public | geometry_columns | table | postgres
 public | spatial_ref_sys  | table | postgres
 public | ways             | table | postgres
(3 rows)

\d ways

               Table &quot;public.ways&quot;
  Column  |       Type       | Modifiers
----------+------------------+-----------
 gid      | integer          | not null
 length   | double precision |
 name     | character(200)   |
 the_geom | geometry         |
Indexes:
        &quot;ways_pkey&quot; PRIMARY KEY, btree (gid)
Check constraints:
        &quot;enforce_dims_the_geom&quot; CHECK (ndims(the_geom) = 2)
        &quot;enforce_geotype_the_geom&quot; CHECK (geometrytype(the_geom) = &#39;MULTILINESTRING&#39;::text OR the_geom IS NULL)
        &quot;enforce_srid_the_geom&quot; CHECK (srid(the_geom) = 4326)
</pre></div>
</div>
</div>
<div class="section" id="create-network-topology">
<h2>Create network topology<a class="headerlink" href="#create-network-topology" title="Permalink to this headline">¶</a></h2>
<p>Having your data imported into a PostgreSQL database usually requires one more
step for pgRouting. You have to make sure that your data provides a correct
network topology, which consists of links with source and target ID each.</p>
<p>If your network data doesn’t have such network topology information already
you need to run the “assign_vertex_id” function. This function assigns a source
and a target ID to each link and it can “snap” nearby vertices within a
certain tolerance.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">assign_vertex_id</span><span class="p">(</span><span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span> <span class="nb">float</span> <span class="n">tolerance</span><span class="p">,</span> <span class="s1">&#39;&lt;geometry column&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;gid&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>First we have to add source and target column, then we run the assign_vertex_id
function … and wait.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ways</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">source</span> <span class="nb">integer</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ways</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">target</span> <span class="nb">integer</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">assign_vertex_id</span><span class="p">(</span><span class="s1">&#39;ways&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">00001</span><span class="p">,</span> <span class="s1">&#39;the_geom&#39;</span><span class="p">,</span> <span class="s1">&#39;gid&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The dimension of the tolerance parameter depends on your data projection.
Usually it’s either “degrees” or “meters”. Because OSM data has a very good
quality for Cape town we can choose a very small “snapping” tolerance:
0.00001 degrees</p>
</div>
</div>
<div class="section" id="add-indices">
<h2>Add indices<a class="headerlink" href="#add-indices" title="Permalink to this headline">¶</a></h2>
<p>Fortunately we didn’t need to wait too long because the data is small. But your
network data might be very large, so it’s a good idea to add an index on source,
target and geometry column.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">source_idx</span> <span class="k">ON</span> <span class="n">ways</span><span class="p">(</span><span class="k">source</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">target_idx</span> <span class="k">ON</span> <span class="n">ways</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">geom_idx</span> <span class="k">ON</span> <span class="n">ways</span> <span class="k">USING</span> <span class="n">GIST</span><span class="p">(</span><span class="n">the_geom</span> <span class="n">GIST_GEOMETRY_OPS</span><span class="p">);</span>
</pre></div>
</div>
<p>After these steps our routing database look like this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>\d

                     List of relations
 Schema |        Name         |   Type   |  Owner
--------+---------------------+----------+----------
 public | geometry_columns    | table    | postgres
 public | spatial_ref_sys     | table    | postgres
 public | vertices_tmp        | table    | postgres
 public | vertices_tmp_id_seq | sequence | postgres
 public | ways                | table    | postgres
(5 rows)

\d ways

               Table &quot;public.ways&quot;
  Column  |       Type       | Modifiers
----------+------------------+-----------
 gid      | integer          | not null
 length   | double precision |
 name     | character(200)   |
 the_geom | geometry         |
 source   | integer          |
 target   | integer          |
Indexes:
        &quot;ways_pkey&quot; PRIMARY KEY, btree (gid)
Check constraints:
        &quot;enforce_dims_the_geom&quot; CHECK (ndims(the_geom) = 2)
        &quot;enforce_geotype_the_geom&quot; CHECK (geometrytype(the_geom) = &#39;MULTILINESTRING&#39;::text OR the_geom IS NULL)
        &quot;enforce_srid_the_geom&quot; CHECK (srid(the_geom) = 4326)
</pre></div>
</div>
<p>Now we are ready for routing with Dijkstra algorithm!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Home</a> &#187;</li>
        <li><a href="#">Load your network data and create a network topology</a></li>
      </ul>
    </div>

	<div class="footer">
      	&copy; Copyright, pgRouting Community<br/>
      	pgRouting website is hosted on <a href="https://github.com/pgRouting/website">Github</a> |
      	<script type="text/javascript">
      		document.write('<a href="mailto:' + new Array("project","pgrouting.org").join("@") + '">Contact administrators</a>');
      	</script>
    </div>

	<!-- Piwik -->
	<script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.georepublic.net/" : "http://stats.georepublic.net/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script type="text/javascript">
	try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 3);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
	} catch( err ) {}
	</script><noscript><p><img src="http://stats.georepublic.net/piwik.php?idsite=3" style="border:0" alt="" /></p></noscript>
	<!-- End Piwik Tag -->

  </body>
</html>